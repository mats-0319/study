# 加密传输工具

本工具可以让两个人在不安全的通信信道上安全的传递信息

## 使用

> 参考`encrypt_transmission/smaple/manual.md`

## 为什么想写这样一个工具

工作中遇到一个情况：需要将一个账上有钱的地址的私钥传输给另一个人。
结果是用人工带一张抄录有助集词（部分）的纸条，纸条缺失部分另行通知。
这样的解决方案让人一言难尽...

我准备写一个命令行程序实现这一过程。
使用DH算法需要协商的过程，我也想过一次编译两个可执行文件，然后协商完再交给使用者，但这样和内置私钥一样了；
如果在线协商呢，那需要一个中心化的第三方，或者双方都做了端口转发/内网穿透。最终决定使用加密算法

- 为什么不使用现有工具：因为目标私钥对应地址上真有钱，不确定现有工具是否绝对可靠

demo：编写技术验证demo遇到问题-最新版本的go（1.25）和ethereum（1.16）无法匹配，将ethereum版本降低到1.13解决

使用场景：甲想要将一段内容传输给乙。
乙需要向甲提供一个公钥，甲使用公钥加密想要传递的内容并将密文提供给乙，乙使用向甲提供的公钥对应的私钥解密密文，得到消息明文。
（公钥和密文可以通过聊天软件传输）

程序功能：

- 对甲来说：使用提供的公钥加密指定内容
- 对乙来说：生成一对公私钥（可选）、使用私钥解密指定内容

程序设计：
启动后等待输入指令，生成的公私钥写成文件，再来一个文件用以提供要加密的明文，加密后的密文也写文件，解密的时候参数都从文件读；
要求使用者将参数文件修改成默认文件名

- 乙可以使用其他来源的密钥对吗？可以，将任意来源的私钥通过go官方库中的`crypto/x509`转成bytes并写入文件，再修改成我们的文件名即可
- 为什么我们不提供乙使用现有密钥的支持？因为本工具是为了安全而写，在设计上就不应该持有私钥，而用我们一次性的私钥就很好

## 技术准备

### 椭圆曲线密码学

Elliptic Curve Cryptography 椭圆曲线密码学(ECC)
Elliptic Curve Digital Signature Algorithm 椭圆曲线数字签名算法(ECDSA)

背景知识：

- 椭圆曲线上的一个点，我们为其定义了加法和乘法运算
- 假设公钥为K、私钥为k、曲线基点为G，有K=kG

#### 加、解密

使用随机数r将明文消息M生成密文C，该密文是一个点对：
C = {rG, M+rK}

解密则是使用C、k还原M的过程：
M = M + rkG - rkG = (M + rK) - k(rG)
即用C的第二个点减去k乘以第一个点，得到的结果就是明文M

#### 签名验签

使用随机数r计算点rG(x,y)
使用r、明文M的哈希h、私钥k计算s=(h+kx)/r
签名行为得到结果：明文M、签名{rG, s}

验签也是一个还原的计算过程：
rG = rG(h+xk)/(h+xk) = (h+xk)G/s = hG/s + xK/s

### DH交换算法(Diffie-Hellman)

DH算法是一种在不安全的通信信道上安全地交换密钥的协议，
算法只协商密钥，不负责加密

原理是在数学问题中，正着计算过去相对容易，而反着推则非常困难。

过程：

- 甲和乙约定两个数p和g
- 甲使用随机数a计算 A = g^a (mod p)
- 乙使用随机数b计算 B = g^b (mod p)
- 甲、乙交换A、B
- 甲计算 S = B^a (mod p)
- 乙计算 S = A^b (mod p)
- 在数学上，两人计算出的S相同

ECDH算法则是结合了椭圆曲线的密钥协商算法
