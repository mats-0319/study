# Goc_ts

根据go语言定义的接口结构，生成http请求对应的ts相关代码

## 使用

> 参考`goc_ts/sample/manual.md`

## 目录

goc_ts

- data: 生成器结构定义（生成器：保存go代码解析结果并据此生成ts代码的结构）
- generate_ts: 根据生成器生成ts代码
- initialize: 初始化功能，包含`-i`/`-g`等启动参数的功能实现
- parse: 解析go代码
- sample: 使用示例
- test: 测试
- utils: 工具库

## 实现（draft）

### 准备

加载配置：优先使用配置文件，找不到文件或文件中不存在的配置项使用默认配置
- c：启动参数，用来指定配置文件，有默认值
- 默认配置：程序内置了一个默认配置

处理启动参数：想要正常解析，需要go接口文件符合一些约定（例如命名规则等，详见下方约定部分），
同时，我们支持生成符合约定的**基础**go接口文件
- i：启动参数，生成默认配置文件`(config_default.json)`和用于生成基础go接口文件的初始化文件示例`(init_default.json)`
- g：启动参数，根据初始化文件生成基础的go接口文件

编辑你的go接口文件，主要是为接口填写输入输出参数，见示例代码`sample`

现在，我们有一组符合约定与业务的go接口文件了，下一步程序的生成器将会解析这些文件。

### 解析go代码

程序会尝试解析指定目录下的所有`.go`文件，通过正则匹配的方式来解析每一个接口，包括uri和输入输出参数，记录在生成器

生成器会根据初步解析的结果开始分析，目前的分析内容主要包含是否需要引入外部函数
- 如果有一个接口包含输入参数，则在序列化输入参数的过程中我们使用`objectToFormData`函数来处理

现在，生成器已经完成了解析，下一步就是生成ts代码了

### 生成ts代码

程序会生成axios的配置文件`config.ts`和外部函数文件`utils.ts`（如果不需要外部函数则不生成）

todo 生成核心代码的部分

## 约定

1. 使用`const URI_xxx=`定义接口uri
2. `type xxx struct {}`将被识别为自定义结构类型，
   其中结构体名称形如`xxxReq`/`xxxRes`的，将被识别为对应接口的输入/输出参数，
   每个定义的接口，其uri、接口输入输出参数名称要求一致。  
   同时，因为要求相关命名一致，我们提供有根据配置生成基础接口定义的功能，参考使用章节
3. 后端应使用`PostForm`解析请求参数

## 开发计划

1. 添加枚举类型的支持
2. 或许可以把go解析参数的代码也生成出来
3. bug: 生成的.http.ts代码没有引入go自定义的结构体
