# 合约可视化工具

> update: 2022.9.30 mario

合约可视化工具（以下简称工具）提供了一个用户界面，可以在界面上管理合约。

管理：部署合约、调用合约函数

## 功能介绍

1. 部署Library
2. 部署合约
3. 调用合约函数
4. 开发者功能（功能入口按钮文本使用英文，正常使用时请忽略），具体功能见下方**功能说明**

tips：
1. 本项目根据**是否需要提供初始化参数**来区分lib和合约，一些不需要初始化参数的合约也按照lib部署

## 编译运行

> windows

1. 编译前端代码，得到`/ui/dist/`文件夹（推荐node版本：16）
2. 执行`/pack.ps1`脚本，得到`/contract_visualization_tool/`文件夹
3. 运行文件夹中的.exe程序，程序会自动打开一个浏览器窗口，接下来的操作将在该窗口执行

## 页面介绍

1. 点击页面顶部栏的**连接钱包**按钮，选择连接方式（walletconnect/metamask）并连接到钱包
2. 下方内容区域分为左、右两部分：左侧选择合约与操作；右侧输入参数、执行操作
3. 正常使用时，请忽略顶部栏的英文按钮

tips：

1. 所有修改操作，都由钱包签发交易，所以交易发往哪条链，取决于钱包连接到哪条链，因此在执行操作前，请再次确认钱包当前连接到的链，以避免财产损失
2. 除了界面上方的提示信息，我们还在控制台(chrome F12)记录了调用结果与错误信息

## 功能说明

部署依赖：

1. 请按照从上到下的顺序依次部署，我们在编辑依赖顺序时，考虑了前置依赖的问题
2. 针对每个依赖，操作顺序为：部署、获取地址，获取到依赖地址，即视为该依赖部署完成

部署合约：

1. 合约字节码仅供查看
2. 部署流程与部署依赖相同：部署、获取地址，获取到合约地址，即视为合约部署完成
3. 合约部署完成后，请记录合约地址，以供后续访问使用

调用合约函数：

1. 在开始使用前，需要提供链地址和合约地址信息
2. 修改操作需要到钱包上处理，所以我们在界面上增加了蒙层与提示

开发者功能：

1. 快速查询：针对已有合约，快速调用其查询函数(view/pure)，不需要登录
2. 查询详细信息：给出区块hash或交易hash，查询区块详情、交易详情、交易收据

## FAQ

1. 如何支持一个新的合约：参考`ui/src/views/cashbox_controller/`，操作步骤：
    1. 参考`data.ts`填写你的合约信息，主要包括deploy code、abi（示例合约及其依赖的lib，deploy code由hardhat生成）
    2. 根据合约abi，参考`invoke.ts`调用合约函数
    3. 编写用户UI
